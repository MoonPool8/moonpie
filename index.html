<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>moon pie</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #eee;
    padding: 20px;
  }
  h1 {
    color: #f5c518;
  }
  .moon-data p {
    margin: 6px 0;
  }
</style>
</head>
<body>
<h1>Live Moon Data</h1>
<div class="moon-data">
  <p><strong>Phase:</strong> <span id="phase">Loading...</span></p>
  <p><strong>Illumination:</strong> <span id="illumination">Loading...</span></p>
  <p><strong>Moonrise:</strong> <span id="moonrise">Loading...</span></p>
  <p><strong>Moonset:</strong> <span id="moonset">Loading...</span></p>
  <p><strong>Moon Altitude:</strong> <span id="altitude">Loading...</span></p>
  <p><strong>Moon Azimuth:</strong> <span id="azimuth">Loading...</span></p>
</div>

<script src="https://cdn.jsdelivr.net/npm/suncalc@1.9.0/suncalc.js"></script>
<script>
  console.log('SunCalc loaded:', SunCalc);

  const lat = 33.9566;
  const lon = -83.9873;

  function formatTime(date) {
    if (!date || isNaN(date.getTime())) return "Unavailable";
    let hours = date.getHours();
    let minutes = date.getMinutes();
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12 || 12;
    minutes = minutes.toString().padStart(2, '0');
    return `${hours}:${minutes} ${ampm}`;
  }

  function getMoonPhaseName(phase) {
    if (phase === 0) return "New Moon";
    if (phase > 0 && phase < 0.25) return "Waxing Crescent";
    if (phase === 0.25) return "First Quarter";
    if (phase > 0.25 && phase < 0.5) return "Waxing Gibbous";
    if (phase === 0.5) return "Full Moon";
    if (phase > 0.5 && phase < 0.75) return "Waning Gibbous";
    if (phase === 0.75) return "Last Quarter";
    if (phase > 0.75 && phase < 1) return "Waning Crescent";
    return "New Moon";
  }

  function getDirectionFromAzimuth(azimuth) {
    const directions = [
      "North", "Northeast", "East", "Southeast",
      "South", "Southwest", "West", "Northwest"
    ];
    // azimuth in radians, convert to degrees
    const deg = (azimuth * 180 / Math.PI + 360) % 360;
    const index = Math.round(deg / 45) % 8;
    return directions[index];
  }

  function updateMoonData() {
    const now = new Date();

    const moonIllum = SunCalc.getMoonIllumination(now);
    const phaseName = getMoonPhaseName(moonIllum.phase);

    document.getElementById('phase').textContent = phaseName;
    document.getElementById('illumination').textContent = `${(moonIllum.fraction * 100).toFixed(1)}%`;

    const moonTimes = SunCalc.getMoonTimes(now, lat, lon);

    document.getElementById('moonrise').textContent = formatTime(moonTimes.rise);
    document.getElementById('moonset').textContent = formatTime(moonTimes.set);

    const moonPos = SunCalc.getMoonPosition(now, lat, lon);
    const altitudeDeg = (moonPos.altitude * 180 / Math.PI).toFixed(1);
    const azimuthDeg = ((moonPos.azimuth * 180 / Math.PI) + 180).toFixed(1);

    document.getElementById('altitude').textContent = `${altitudeDeg}°`;
    document.getElementById('azimuth').textContent = `${azimuthDeg}° (${getDirectionFromAzimuth(moonPos.azimuth)})`;

    console.log('Moon Data Updated:', {
      phaseName, illumination: moonIllum.fraction,
      moonrise: moonTimes.rise,
      moonset: moonTimes.set,
      altitude: altitudeDeg,
      azimuth: azimuthDeg,
    });
  }

  updateMoonData();
  setInterval(updateMoonData, 5000); // update every minute
</script>
</body>
</html>
